# Original version of this tracker. Kept for reference

import json,os,shutil

list_file = "./tasks.json"

def main():
    while True:
        try:
            with open(list_file, 'r') as file:
                pass
        except FileNotFoundError:
            os.system('echo "tasks": [] > ./tasks.json') 
        
        os.system("clear")

        test = input("What would you like to do?\n1. Print Tasks List\n2. Add Task\n3. Edit Task\n4. Remove Task\n5. Exit\n\n> ")
        match test:
            case '1':
                print_list()
                return_main()
            case '2':
                add_task_menu()
            case '3':
                edit_task_menu()
            case '4':
                remove_task()
            case '5':
                exit()
            case _:
                os.system("clear")
                print("Not a valid option")

# Function for returning to the main menu
def return_main():
    print(" ")
    input("Press any key to return to the menu...")
    
# Prints out list of tasks in order along with status and due date
def print_list(t_list=list_file):
    os.system("clear")
    print(f"""************************
*- Current Tasks List -*
************************""")
    task_list = open_task_list(list_file) if t_list == list_file else t_list
    
    for item in task_list['tasks']:
        print(f"{item['id']}. {item['name']} - Status: {item['status']} - Due: {item['dueDate']}")
    
# Menu for setting up a task for adding    
def add_task_menu():
    os.system("clear")
    task_name = input("What is the name of the task?\n\n> ")
    task_status = input("Have you started this task already?\n\n> ")
    task_due_date = ""

    match task_status[:1].lower():
        case "n":
            task_status = "Not started"
            task_due_date = input("When do you need to have this task done?\n\n> ")
        case "y":
            if input("Have you already completed this task?\n\n> ")[:1].lower() == "n":
                task_status = "In Progress"
                task_due_date = input("When do you need to have this task done?\n")
            elif input("Have you already completed this task?\n\n> ")[:1].lower() == "y": 
                task_status = "Completed"
            else:
                print("Something is wrong with you.")
                return_main()
        case _:
            print("That is not an option. Correct yourself.")
            return_main()

    
    print(f"{task_name} added. Current status: {task_status}. Due: {task_due_date}.")

    new_task = {
        "name": task_name,
        "status": task_status,
        "dueDate":task_due_date
    }

    add_task(new_task, list_file)

    return_main()

# Function that adds the new task to the task.json file
def add_task(task_to_add, list):
    task_list = open_task_list(list_file)
    task_to_add = {"id": len(task_list['tasks']) + 1} | task_to_add
    task_list['tasks'].append(task_to_add)

    with open(list, mode='w') as file:
        json.dump(task_list, file, indent=2)

    print(f"Task {task_to_add['name']} added to tasks list.")

def edit_task_menu():
    task_list = open_task_list(list_file)

    while True:
        os.system("clear")
        print_list(task_list)
        print(" ")
        task_select = int(input("Which task would you like to edit?\n\n> ")) - 1 
        task_to_edit = task_list["tasks"][task_select]
        os.system("clear")
        option_select = input(f"Task selected: {task_to_edit["name"]}\nCurrent Status:{task_to_edit["status"]}\nCurrent due date: {task_to_edit["dueDate"]}\n\nWhat would you like to change?\n\n1. Name\n2. Status\n3. Due Date\n\n> ")

        match option_select:
            case "1":
                os.system("clear")
                print(f"Current status: {task_to_edit["status"]}\n\n")
                new_name = input("What do you want the new name to be?\n\n> ")
                task_to_edit["name"] = new_name
            case "2":
                os.system("clear")
                print(f"Current status: {task_to_edit["status"]}\n\n")
                status_select = input("What is the new status?\n\n1. Not Started\n2. In Progress\n3. On-hold\n\n> ")
                match status_select:
                    case "1":
                        task_to_edit["status"] = "Not Started"
                    case "2":
                        task_to_edit["status"] = "In Progress"
                    case "3":
                        task_to_edit["status"] = "On-hold"
                    case _:
                        print("Unknown value. No changes made.")
            case "3":
                os.system("clear")
                print(f"Current due date: {task_to_edit["dueDate"]}\n\n")
                new_date = input(f"What is the new due date?\n\n> ")
                task_to_edit["dueDate"] = new_date
        
        more_edit = input("Would you like to make more edits? (y/n)\n\n> ")
        
        if more_edit[:1].lower() == "n":
            break

    
    print(task_list)
    # with open(list_file, "w") as file:
    #     json.dump(task_list, file, indent=2)

    return_main()

def remove_task():
    task_list = open_task_list(list_file)

    os.system("clear")
    print_list()
    print(" ")
    task_to_remove = int(input("Type the number of the task you would like to remove:\n\n> ")) - 1 
    removed_task = task_list["tasks"][task_to_remove]["name"]
    del task_list["tasks"][task_to_remove]

    confirm = input(f"Are you sure you want to remove {removed_task}? (y/n)\n\n> ")

    if confirm[:1].lower() == "y":
        with open(list, mode='w') as file:
            json.dump(task_list, file, indent=2)
        print(f"Task {removed_task} removed from tasks list.")
    elif confirm[:1].lower() == "n":
        print("Removal process aborted.")
    else:
        print("Input out of acceptable range. Removal process aborted")
   
    return_main()

def open_task_list(task_file):
    with open(task_file, mode='r') as file:
        list_data = json.load(file)
    
    return list_data

main()  